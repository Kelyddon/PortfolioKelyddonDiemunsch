{% extends 'base.html.twig' %}

{% block title %}Projets{% endblock %}

{% block body %}
    <div class="projects-title">Projets réalisés</div>
    <div class="projects-grid">
        {% for project in projects %}
            <div class="project-card">
                <div class="project-title">{{ project.name }}</div>
                <div class="project-media">
                    {% if project.image %}
                        <img src="/{{ project.image }}" alt="Image projet {{ project.name }}">
                    {% else %}
                        <div class="project-placeholder">Aucune image</div>
                    {% endif %}
                </div>
                <div class="project-langs">
                    {% if project.langages is iterable %}
                        {% for lang in project.langages %}
                            <span class="lang-chip">{{ lang }}</span>
                        {% endfor %}
                    {% elseif project.langages %}
                        <span class="lang-chip">{{ project.langages }}</span>
                    {% else %}
                        <span class="lang-chip">Langages non renseignés</span>
                    {% endif %}
                </div>
                <div class="project-desc">{{ project.description|e|nl2br }}</div>
                <div class="project-actions">
                    {% if project.GithubLink %}
                        <a class="btn-github" href="{{ project.GithubLink }}" target="_blank" rel="noopener">Voir sur GitHub</a>
                    {% endif %}

                    {# Afficher les actions d'administration uniquement pour les admins #}
                    {% if is_granted('ROLE_ADMIN') %}
                        <div style="display:flex;gap:12px;justify-content:center;margin-top:8px;">
                            <a href="{{ path('app_project_edit', {'id': project.id}) }}" class="cv-button">Éditer</a>
                            <form method="post" action="{{ path('app_project_delete', {'id': project.id}) }}" onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce projet ?');">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ project.id) }}">
                                <button type="submit" class="cv-button project-delete-btn" style="background:#e74c3c;color:#fff;border-color:#e74c3c;">Supprimer</button>
                            </form>
                        </div>
                    {% endif %}
                </div>
            </div>
        {% else %}
            <div style="grid-column:1/-1;text-align:center;color:#888;font-size:1.2rem;padding:40px 0;">Aucun projet trouvé</div>
        {% endfor %}
    </div>
{% endblock %}